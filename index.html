<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save and View Data</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="colors.css">
    <script src="https://kit.fontawesome.com/87b26c3ff4.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: Nunito;
        }
        td {
            border: 2px solid #ddd;
            background-color: #ffffff;
            border-radius: 8px;
            padding: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        td:hover {
            filter: brightness(0.94);
        }
        th {
            font-size: 20px;
            border: 2px solid #ddd;
            background-color: #ffffff;
            border-radius: 15px;
            padding: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        th:hover {
            filter: brightness(0.94);
        }
        /* td b {
            font-size: 18px;
            background-color: rgb(255, 248, 113);
            border-radius: 6px;
            padding-inline: 4px;
        } */
        .information {
            visibility: hidden;
            min-width: 300px;
            background-color: #ffffff;
            border: 2px solid #ddd;
            font-family: Nunito;
            text-align: left;
            padding: 10px;
            border-radius: 5px;
            position: absolute;
            z-index: 1000;
            bottom: 125%; /* Position above the question mark */
            left: 50%;
            margin-left: -153px; /* Centers the information */
            opacity: 0;
            transition: opacity 0.3s;
            transform: translateX(-10px)translateY(15px);
        }
        /* information arrow */
        .information::after {
            content: "";
            position: absolute;
            top: 100%; /* At the bottom of the information */
            left: 50%;
            margin-left: -8px;
            border-width: 8px;
            border-style: solid;
            border-color: #ddd transparent transparent transparent;
        }
        a#close-button {
            float: right;
            padding-inline: 5px;
            padding-top: 1px;
            font-weight: 500;
            border-radius: 0px;
            transition: background-color 0.4s, border-radius 0.5s;
        }
        a#close-button:hover {
            background-color: #ececec;
            border-radius: 4px;
        }
        .reset {
            float: left;
            padding: 5px;
            margin-right: 4px;
            border-radius: 0px;
            transition: background-color 0.4s, border-radius 0.5s;
        }
        .reset:hover {
            background-color: #ececec;
            border-radius: 4px;
        }
        a#edit-button {
            float: left;
            background-color: #ececec;
            margin-top: 10px;
            padding-inline: 5px;
            padding-top: 1px;
            font-weight: 500;
            border-radius: 2px;
            transition: background-color 0.2s, border-radius 0.5s, padding 0.5s, font-weight 0.5s;
        }
        a#edit-button:hover {
            padding-inline: 8px;
            font-weight: 700;
            background-color: #dddddd;
            border-radius: 4px;
        }
        .week-control a i {
            background-color: #ffb974;
            color: rgb(255, 255, 255);
            padding: 6px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 18px;
            margin-block: 10px;
            transition: background-color 0.3s;
        }
        .week-control a i:hover {
            background-color: #ffce9d;
        }
        .week-control p {
            font-weight: 700;
            font-size: 18px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Save Data</h1>
    <label for="titleInput">Title:</label>
    <input type="text" id="titleInput" placeholder="Enter title"><br>
    
    <label for="dateInput">Date:</label>
    <input type="text" id="dateInput" placeholder="Enter date"><br>
    
    <button onclick="saveDataList()">Save</button>

    <div style="display: flex; align-items: center; gap: 8px;" class="week-control">
        <a id="week-back"><i class='fa-solid fa-arrow-left' aria-hidden='true'></i></a>
        <p id="week-display">Kalendarwoche 48</p>
        <a id="week-foreward"><i class='fa-solid fa-arrow-right' aria-hidden='true'></i></a>
    </div>

    <table style="width: 100%;" id="agenda">
        <colgroup>
            <col style="width: calc(100% / 7);">
            <col style="width: calc(100% / 7);">
            <col style="width: calc(100% / 7);">
            <col style="width: calc(100% / 7);">
            <col style="width: calc(100% / 7);">
            <col style="width: calc(100% / 7);">
            <col style="width: calc(100% / 7);">
        </colgroup>
        <tr>
            <th id="monday">Montag</th>
            <th id="tuesday">Dienstag</th>
            <th id="wednesday">Mittwoch</th>
            <th id="thursday">Donnerstag</th>
            <th id="friday">Freitag</th>
            <th id="saturday">Samstag</th>
            <th id="sunday">Sonntag</th>
        </tr>
    </table>

    <h2>Saved Data</h2>
    <ul id="dataList"></ul>

    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDZPKHBaMBCcpdYSybKZ9WUWySs09nYWZs",
            authDomain: "agenda-personal-e5887.firebaseapp.com",
            databaseURL: "https://agenda-personal-e5887-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "agenda-personal-e5887",
            storageBucket: "agenda-personal-e5887.firebasestorage.app",
            messagingSenderId: "235729868377",
            appId: "1:235729868377:web:2091a2dc07932eb8848348",
            measurementId: "G-HRQXW3X1D4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Save data to the database
        async function saveDataList() {
            const title = document.getElementById('titleInput').value.trim();
            const date = document.getElementById('dateInput').value.trim();

            if (!title || !date) {
                alert('Please fill in both title and date!');
                return;
            }

            // Create an object to store
            const data = {
                title: title,
                date: date
            };

            // Push the object to Firebase
            const dataRef = ref(database, 'entries/');
            await push(dataRef, data);

            alert('Data saved successfully!');
            document.getElementById('titleInput').value = ''; // Clear title input
            document.getElementById('dateInput').value = ''; // Clear date input
            loadDataList(); // Reload data
        }

        // Load data from the database
        function loadDataList() {
            const dataList = document.getElementById('dataList');
            dataList.innerHTML = ''; // Clear the list

            const dataRef = ref(database, 'entries/');
            onValue(dataRef, (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    const entry = childSnapshot.val();
                    const listItem = document.createElement('li');
                    listItem.textContent = `Title: ${entry.title}, Date: ${entry.date}`;
                    dataList.appendChild(listItem);
                });
            });
        }
        async function saveData(data) {
            const dataRef = ref(database, 'events/');
            await push(dataRef, data);
        }
        async function loadData() {
            const dataRef = ref(database, 'events/');
            return new Promise((resolve, reject) => {
                let loadedData = [];
                onValue(dataRef, (snapshot) => {
                    snapshot.forEach((childSnapshot) => {
                        const entry = childSnapshot.val();
                        const key = childSnapshot.key;
                        loadedData.push({ key, ...entry }); // Spread entry data directly into the object
                    });
                    resolve(loadedData); // Return data in the desired format
                }, (error) => {
                    reject(error);
                });
            });
        }
        async function editData(key, newData) {
            const dataRef = ref(database, `events/${key}`); // Use the key to reference the specific data entry.
            await update(dataRef, newData); // Update the data at the specified path.
        }
        async function findKeyByTypeAndChange(week, day, row, type, change = null) {
            const dataRef = ref(database, 'events/');

            return new Promise((resolve, reject) => {
                onValue(dataRef, (snapshot) => {
                    let foundKey = null;
                
                    snapshot.forEach((childSnapshot) => {
                        const entry = childSnapshot.val();
                    
                        // Check if week, day, and row match
                        if (entry.week === week && entry.day === day && entry.row === row) {
                            if (entry.type === type) {
                                // If type is "change", check the change field if provided
                                if (type === "change") {
                                    if (change && entry.change === change) {
                                        foundKey = childSnapshot.key; // Found key matching change
                                    } else if (!change) {
                                        foundKey = childSnapshot.key; // Found key if no specific change is required
                                    }
                                } else if (type === "homework") {
                                    if (change && entry.homework === change) {
                                        foundKey = childSnapshot.key; // Found key matching change
                                    } else if (!change) {
                                        foundKey = childSnapshot.key; // Found key if no specific change is required
                                    }
                                } else {
                                    // If type is "exam", no need to check change field
                                    foundKey = childSnapshot.key; // Found key if type is "exam"
                                }
                            }
                        }
                    });
                
                    if (foundKey) {
                        resolve(foundKey); // Return the key
                    } else {
                        reject("No matching entry found");
                    }
                });
            });
        }
        async function removeData(key) {
            const specificDataRef = ref(database, `events/${key}`);  // Reference to a specific data entry
            try {
                await remove(specificDataRef);  // Remove the data at that key
                console.log('Data removed successfully');
            } catch (error) {
                console.error('Error removing data: ', error);
            }
        }


        // Attach functions to the window object
        window.saveDataList = saveDataList;
        window.loadDataList = loadDataList;
        window.saveData = saveData;
        window.loadData = loadData;
        window.editData = editData;
        window.findKeyByTypeAndChange = findKeyByTypeAndChange;
        window.removeData = removeData;

        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadDataList);
    </script>
    <script src="data.js" type="text/javascript"></script>
    <script>
        let currentlyDisplayingInfo = false;
        let currentlyEditingInfo = false;
        var agenda = document.getElementById("agenda");
        function getWeekNumber(date = new Date()) {
            // Create a new date object for the first day of the year
            const startOfYear = new Date(date.getFullYear(), 0, 1);
            // Calculate the difference in milliseconds
            const daysSinceStartOfYear = Math.floor((date - startOfYear) / (1000 * 60 * 60 * 24));
            // Get the day of the week for the start of the year (0 = Sunday, 6 = Saturday)
            const dayOfWeek = startOfYear.getDay();
            // Adjust to make Monday the first day of the week (ISO)
            const dayOffset = (dayOfWeek === 0 ? 6 : dayOfWeek - 1);
            // Calculate the week number
            return Math.ceil((daysSinceStartOfYear + dayOffset) / 7);
        }
        let currentWeek = getWeekNumber();
        function addingEvents(usedAgenda) {

        }
        async function reloadTable() {
            agenda.innerHTML = `<colgroup>
                <col style="width: calc(100% / 7);">
                <col style="width: calc(100% / 7);">
                <col style="width: calc(100% / 7);">
                <col style="width: calc(100% / 7);">
                <col style="width: calc(100% / 7);">
                <col style="width: calc(100% / 7);">
                <col style="width: calc(100% / 7);">
            </colgroup>
            <tr>
                <th id="monday">Montag</th>
                <th id="tuesday">Dienstag</th>
                <th id="wednesday">Mittwoch</th>
                <th id="thursday">Donnerstag</th>
                <th id="friday">Freitag</th>
                <th id="saturday">Samstag</th>
                <th id="sunday">Sonntag</th>
            </tr>`
            switch (new Date().getDay()) {
                case 0:
                    document.getElementById("sunday").style.backgroundColor = "#ffe9d3";
                    document.getElementById("sunday").style.borderColor = "#ffd1a4";
                    break;
                case 1:
                    document.getElementById("monday").style.backgroundColor = "#ffe9d3";
                    document.getElementById("monday").style.borderColor = "#ffd1a4";
                    break;
                case 2:
                    document.getElementById("tuesday").style.backgroundColor = "#ffe9d3";
                    document.getElementById("tuesday").style.borderColor = "#ffd1a4";
                    break;
                case 3:
                    document.getElementById("wednesday").style.backgroundColor = "#ffe9d3";
                    document.getElementById("wednesday").style.borderColor = "#ffd1a4";
                    break;
                case 4:
                    document.getElementById("thursday").style.backgroundColor = "#ffe9d3";
                    document.getElementById("thursday").style.borderColor = "#ffd1a4";
                    break;
                case 5:
                    document.getElementById("friday").style.backgroundColor = "#ffe9d3";
                    document.getElementById("friday").style.borderColor = "#ffd1a4";
                    break;
                case 6:
                    document.getElementById("saturday").style.backgroundColor = "#ffe9d3";
                    document.getElementById("saturday").style.borderColor = "#ffd1a4";
                    break;
            }
            let agendaTable = structuredClone(defaultTable);
            agendaTable.forEach((row, rowIndex) => {
                if (row.length < 7) {
                    Array.from({ length: 7 - row.length }, () => {
                        agendaTable[rowIndex].push({})
                    });
                }
            })
            agendaEvents = await loadData()
            agendaEvents.forEach((event) => {
                if (event.week == currentWeek) {
                    if (!agendaTable[event.row][event.day].special) {
                        agendaTable[event.row][event.day].special = {};
                    }
                    switch (event.type) {
                        case "exam":
                            agendaTable[event.row][event.day].special.exam = true;
                            break;
                        case "change":
                            if (!agendaTable[event.row][event.day].special.change) {
                                agendaTable[event.row][event.day].special.change = {};
                            }
                            switch (event.change) {
                                case "subject":
                                    agendaTable[event.row][event.day].special.change.subject = event.value;
                                    break;
                                case "room":
                                    agendaTable[event.row][event.day].special.change.room = event.value;
                                    break;
                                case "teacher":
                                    agendaTable[event.row][event.day].special.change.teacher = event.value;
                                    break;
                            }
                            break;
                        case "homework":
                            agendaTable[event.row][event.day].special.homework = event.homework;
                            break;
                    }
                }
            });
            agendaTable.forEach((row, rowIndex) => {
                let currentRow = document.createElement("tr");
                if (rowIndex == 3) {
                    let pause = document.createElement("th");
                    pause.innerText = "Zehnuhrpause";
                    pause.setAttribute("colspan", "7");
                    agenda.appendChild(pause);
                }
                if (rowIndex == 5) {
                    let pause = document.createElement("th");
                    pause.style.paddingBlock = "15px";
                    pause.innerText = "Mittagspause";
                    pause.style.fontSize = "28px";
                    pause.setAttribute("colspan", "7");
                    agenda.appendChild(pause);
                }
                row.forEach((cell, columnIndex) => {
                    let currentCell = document.createElement("td");
                    let currentInformations = []
                    if (Object.keys(cell).length != 0) {
                        let examNow;
                        let nowSubject;
                        let modSubject = cell.subject;
                        let modRoom = cell.room;
                        let modTeacher = cell.teacher;
                        if (cell.special) {
                            if (cell.special.change) {
                                if (cell.special.change.subject) { modSubject = cell.special.change.subject }
                                if (cell.special.change.room) { modRoom = cell.special.change.room }
                                if (cell.special.change.teacher) { modTeacher = cell.special.change.teacher }
                            }
                            if (cell.special.exam) {
                                examNow = "<b style='color: #d93c41; font-weight: 800; font-size: 20px;'>Prüfung!</b><br>";
                                nowSubject = "<span style='color: #d93c41; font-weight: 800;'>!</span> " + modSubject;
                            } else {
                                examNow = "";
                                nowSubject = modSubject;
                            }
                        } else {
                            examNow = "";
                            nowSubject = cell.subject;
                        }
                        currentCell.style.position = "relative";
                        currentInformations = [
                            ("<a id='close-button'><i class='fa-solid fa-xmark' aria-hidden='true'></i></a>" + examNow + "<b>Fach: </b>" + modSubject),
                            ("<b>Raum: </b>"+modRoom),
                            ("<b>Lehrer/in: </b>"+modTeacher),
                            ("<a id='edit-button'>Änderung einführen</a>")
                        ]
                        currentCell.innerHTML = "<b"+(cell.subject != modSubject ? " style='background-color: rgb(255, 255, 0, 0.5); border-radius: 4px; padding-inline: 3px;'>" : ">")+nowSubject+"</b><br><span"+
                            (cell.room != modRoom ? " style='background-color: rgb(255, 255, 0, 0.5); border-radius: 4px; padding-inline: 3px;'>" : ">")+modRoom+"</span><br><span"+
                            (cell.teacher != modTeacher ? " style='background-color: rgb(255, 255, 0, 0.5); border-radius: 4px; padding-inline: 3px;'>" : ">")+modTeacher+"</span><span class='information'>" +
                            currentInformations.join("<br>") + "</span>";
                        if (subjectList[modSubject]) {
                            currentCell.className = subjectList[modSubject]
                        }
                        currentCell.lastElementChild.querySelector("#close-button").addEventListener('click', () => {
                            setTimeout(() => {
                                currentlyDisplayingInfo = false;
                                currentlyEditingInfo = false;
                                currentCell.lastElementChild.style.opacity = "0";
                                setTimeout(() => {
                                    currentCell.lastElementChild.style.visibility = "hidden";
                                }, 300);
                            }, 100);
                        });
                        currentCell.lastElementChild.querySelector("#edit-button").addEventListener('click', () => {
                            let subjectOptions = ""
                            subjectArray.forEach((subjectOption) => {
                                subjectOptions += "<option value='" + subjectOption + "'>" + subjectOption + "</option>"
                            });
                            currentInformationsWhenEditing = [
                                ("<a id='close-button'><i class='fa-solid fa-xmark' aria-hidden='true'></i></a><input type='checkbox' id='exam-check' style='float: left;'><span style='padding-left: 6px;transform: translateY(-0.7px); float: left; color: #d93c41; font-weight: 800;'> Prüfung</span></input>"),
                                ("<b>Fach: </b>" + modSubject),
                                ("<a id='reset-subject'><i class='fa-solid fa-arrow-rotate-right reset' aria-hidden='true'></i></a><select id='subject-option' style='margin-top: 4px; margin-bottom: 3px;'>" + subjectOptions + "</select>"),
                                ("<b>Raum: </b>"+modRoom),
                                ("<a id='reset-room'><i class='fa-solid fa-arrow-rotate-right reset' aria-hidden='true'></i></a><input type='text' id='room-input' style='margin-top: 2px; margin-bottom: 3px;'>"),
                                ("<b>Lehrer/in: </b>"+modTeacher),
                                ("<a id='reset-teacher'><i class='fa-solid fa-arrow-rotate-right reset' aria-hidden='true'></i></a><input type='text' id='teacher-input' style='margin-top: 2px; margin-bottom: 3px;'>"),
                                ("<b>Hausaufgaben: </b>"+(cell.special && cell.special.homework ? cell.special.homework : "Keine Hausaufgaben")),
                                ("<input type='text' id='homework-input' style='margin-top: 0px; margin-bottom: 3px;'>"),
                                ("<a id='edit-button'>Änderung speichern</a></span>")
                            ]
                            currentCell.innerHTML = "<b>"+nowSubject+"</b><br>"+modRoom+"<br>"+modTeacher+"<span class='information'>" + currentInformationsWhenEditing.join("<br>");
                            const isExam = cell.special && cell.special.exam ? true : false;
                            const isHomework = cell.special && cell.special.homework ? cell.special.homework : false
                            currentCell.lastElementChild.querySelector("#exam-check").checked = isExam;
                            currentCell.lastElementChild.querySelector("#subject-option").value = modSubject;
                            currentCell.lastElementChild.querySelector("#room-input").value = modRoom;
                            currentCell.lastElementChild.querySelector("#teacher-input").value = modTeacher;
                            currentCell.lastElementChild.style.opacity = "1";
                            currentCell.lastElementChild.style.visibility = "visible";
                            currentCell.lastElementChild.querySelector("#close-button").addEventListener('click', () => {
                                setTimeout(() => {
                                    currentlyDisplayingInfo = false;
                                    currentlyEditingInfo = false;
                                    currentCell.lastElementChild.style.opacity = "0";
                                    setTimeout(() => {
                                        currentCell.lastElementChild.style.visibility = "hidden";
                                        reloadTable()
                                    }, 300);
                                }, 100);
                            });
                            currentCell.lastElementChild.querySelector("#reset-subject").addEventListener('click', () => {
                                currentCell.lastElementChild.querySelector("#subject-option").value = cell.subject;
                            });
                            currentCell.lastElementChild.querySelector("#reset-room").addEventListener('click', () => {
                                currentCell.lastElementChild.querySelector("#room-input").value = cell.room;
                            });
                            currentCell.lastElementChild.querySelector("#reset-teacher").addEventListener('click', () => {
                                currentCell.lastElementChild.querySelector("#teacher-input").value = cell.teacher;
                            });
                            console.log(currentCell.lastElementChild)
                            currentCell.lastElementChild.querySelector("#edit-button").addEventListener('click', async () => {
                                if (currentCell.lastElementChild.querySelector("#exam-check").checked != isExam) {
                                    if (isExam) {
                                        let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "exam");
                                        await removeData(currentKey);
                                    } else {
                                        saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "exam", exam: true});
                                    }
                                }
                                // if (currentCell.lastElementChild.querySelector("#subject-option").value != modSubject) {
                                //     if (currentCell.lastElementChild.querySelector("#subject-option").value != cell.subject) {
                                //         if (modSubject == cell.subject) {
                                //             saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "subject", value: currentCell.lastElementChild.querySelector("#subject-option").value});
                                //         } else {
                                //             let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "subject");
                                //             await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "subject", value: currentCell.lastElementChild.querySelector("#subject-option").value});
                                //         }
                                //     } else {
                                //         let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "subject");
                                //         await removeData(currentKey);
                                //     }
                                // }
                                if (modSubject != "" && modSubject != currentCell.lastElementChild.querySelector("#subject-option").value && currentCell.lastElementChild.querySelector("#subject-option").value != "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "subject");
                                    await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "subject", value: currentCell.lastElementChild.querySelector("#subject-option").value});
                                }
                                else if (modSubject == "" && currentCell.lastElementChild.querySelector("#subject-option").value != "") {
                                    await saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "subject", value: currentCell.lastElementChild.querySelector("#subject-option").value});
                                }
                                else if (modSubject != "" && currentCell.lastElementChild.querySelector("#subject-option").value == "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "subject");
                                    await removeData(currentKey);
                                }
                                // if (currentCell.lastElementChild.querySelector("#room-input").value != modRoom && currentCell.lastElementChild.querySelector("#room-input").value != "") {
                                //     if (currentCell.lastElementChild.querySelector("#room-input").value != cell.room) {
                                //         if (modRoom == cell.room) {
                                //             saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "room", value: currentCell.lastElementChild.querySelector("#room-input").value});
                                //         } else {
                                //             let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "room");
                                //             await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "room", value: currentCell.lastElementChild.querySelector("#room-input").value});
                                //         }
                                //     } else {
                                //         let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "room");
                                //         await removeData(currentKey);
                                //     }
                                // }
                                if (modRoom != "" && modRoom != currentCell.lastElementChild.querySelector("#room-input").value && currentCell.lastElementChild.querySelector("#room-input").value != "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "room");
                                    await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "room", value: currentCell.lastElementChild.querySelector("#room-input").value});
                                }
                                else if (modRoom == "" && currentCell.lastElementChild.querySelector("#room-input").value != "") {
                                    await saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "room", value: currentCell.lastElementChild.querySelector("#room-input").value});
                                }
                                else if (modRoom != "" && currentCell.lastElementChild.querySelector("#room-input").value == "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "room");
                                    await removeData(currentKey);
                                }
                                // if (currentCell.lastElementChild.querySelector("#teacher-input").value != modTeacher && currentCell.lastElementChild.querySelector("#teacher-input").value != "") {
                                //     if (currentCell.lastElementChild.querySelector("#teacher-input").value != cell.teacher) {
                                //         if (modTeacher == cell.teacher) {
                                //             saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "teacher", value: currentCell.lastElementChild.querySelector("#teacher-input").value});
                                //         } else {
                                //             let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "teacher");
                                //             await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "teacher", value: currentCell.lastElementChild.querySelector("#teacher-input").value});
                                //         }
                                //     } else {
                                //         let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "teacher");
                                //         await removeData(currentKey);
                                //     }
                                // }
                                if (modTeacher != "" && modTeacher != currentCell.lastElementChild.querySelector("#teacher-input").value && currentCell.lastElementChild.querySelector("#teacher-input").value != "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "teacher");
                                    await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "teacher", value: currentCell.lastElementChild.querySelector("#teacher-input").value});
                                }
                                else if (modTeacher == "" && currentCell.lastElementChild.querySelector("#teacher-input").value != "") {
                                    await saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "teacher", value: currentCell.lastElementChild.querySelector("#teacher-input").value});
                                }
                                else if (modTeacher != "" && currentCell.lastElementChild.querySelector("#teacher-input").value == "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "teacher");
                                    await removeData(currentKey);
                                }
                                // if (currentCell.lastElementChild.querySelector("#homework-input").value != cell.homework && currentCell.lastElementChild.querySelector("#homework-input").value != "") {
                                //     if (currentCell.lastElementChild.querySelector("#homework-input").value != cell.homework) {
                                //         if ("" == cell.homework) {
                                //             saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "homework", homework: currentCell.lastElementChild.querySelector("#teacher-input").value});
                                //         } else {
                                //             let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "change", "teacher");
                                //             await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "change", change: "teacher", value: currentCell.lastElementChild.querySelector("#teacher-input").value});
                                //         }
                                //     } else {
                                //         let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "homework", cell.homework);
                                //         await removeData(currentKey);
                                //     }
                                // } else {
                                //     if (currentCell.lastElementChild.querySelector("#homework-input").value == cell.homework && currentCell.lastElementChild.querySelector("#homework-input").value == "") {
                                //         let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "homework", cell.homework);
                                //         await removeData(currentKey);
                                //     }
                                // }
                                console.log("homework");
                                // if (currentCell.lastElementChild.querySelector("#homework-input").value != cell.special && (cell.special.homework ? true : false)) {
                                //     if (currentCell.lastElementChild.querySelector("#homework-input").value != "") {
                                //         let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "homework", cell.special.homework);
                                //         await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "homework", homework: currentCell.lastElementChild.querySelector("#homework-input").value});
                                //         if (cell.special.homework == "") {
                                //             saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "homework", homework: currentCell.lastElementChild.querySelector("#homework-input").value});
                                //         } else {
                                //             let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "homework", cell.special.homework);
                                //             await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "homework", homework: currentCell.lastElementChild.querySelector("#homework-input").value});
                                //         }
                                //     } else {
                                //         let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "homework", cell.special.homework);
                                //         await removeData(currentKey);
                                //     }
                                // }
                                if (isHomework != "" && isHomework != currentCell.lastElementChild.querySelector("#homework-input").value && currentCell.lastElementChild.querySelector("#homework-input").value != "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "homework", cell.special.homework);
                                    await editData(currentKey, {week: currentWeek, day: columnIndex, row: rowIndex, type: "homework", homework: currentCell.lastElementChild.querySelector("#homework-input").value});
                                }
                                else if (isHomework == "" && currentCell.lastElementChild.querySelector("#homework-input").value != "") {
                                    await saveData({week: currentWeek, day: columnIndex, row: rowIndex, type: "homework", homework: currentCell.lastElementChild.querySelector("#homework-input").value});
                                }
                                else if (isHomework != "" && currentCell.lastElementChild.querySelector("#homework-input").value == "") {
                                    let currentKey = await findKeyByTypeAndChange(currentWeek, columnIndex, rowIndex, "homework", cell.special.homework);
                                    await removeData(currentKey);
                                }
                                setTimeout(() => {
                                    currentlyDisplayingInfo = false;
                                    currentlyEditingInfo = false;
                                    currentCell.lastElementChild.style.opacity = "0";
                                    setTimeout(() => {
                                        currentCell.lastElementChild.style.visibility = "hidden";
                                        reloadTable()
                                    }, 300);
                                }, 100);
                            });
                        });
                        currentRow.appendChild(currentCell);
                    } else {
                        currentCell.style = "border: 2px dashed #ddd";
                        currentCell.innerHTML = "</span><span class='information'><a id='close-button'><i class='fa-solid fa-xmark' aria-hidden='true'></i></a>Füge Fach hier hinzu!<a id='edit-button'>Änderung einführen</a></span>"
                        currentCell.style.position = "relative";
                        currentRow.appendChild(currentCell);
                    }
                    if (columnIndex == 0) {
                        currentCell.lastElementChild.style.marginLeft = "-124px";
                    }
                    if (columnIndex == 6) {
                        currentCell.lastElementChild.style.marginLeft = "-180px";
                    }
                    currentCell.lastElementChild.querySelector("#close-button").addEventListener('click', () => {
                        setTimeout(() => {
                            currentlyDisplayingInfo = false;
                            currentCell.lastElementChild.style.opacity = "0";
                            setTimeout(() => {
                                currentCell.lastElementChild.style.visibility = "hidden";
                            }, 300)
                        }, 100)
                    })
                });
                agenda.appendChild(currentRow);
            });

        const cells = document.querySelectorAll("#agenda td");

        // Loop through each cell and make it clickable
        cells.forEach(cell => {
            cell.onclick = function () {
                const rowIndex = this.parentElement.rowIndex - 1; // Row of the clicked cell
                const colIndex = this.cellIndex;
                cellInteraction(rowIndex, colIndex, this)
            };
        });
        }
        function cellInteraction(row, column, cell) {
            if (!currentlyDisplayingInfo) {
                cell.lastElementChild.style.visibility = "visible";
                cell.lastElementChild.style.opacity = "1";
                currentlyDisplayingInfo = true;
            }
        }
        document.getElementById("week-back").addEventListener('click', () => {
            currentWeek -= 1;
            document.getElementById("week-display").textContent = "Kalendarwoche " + currentWeek;
            reloadTable();
        });
        document.getElementById("week-foreward").addEventListener('click', () => {
            currentWeek += 1;
            document.getElementById("week-display").textContent = "Kalendarwoche " + currentWeek;
            reloadTable();
        });
        setTimeout(() => {
            reloadTable()
        }, 300)
    </script>
</body>
</html>
